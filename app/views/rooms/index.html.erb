<% provide(:title, "talk room") %>
<h1>トークルーム</h1>

<div class="row">
  <div class="col-md-6 col-md-offset-3">
    <ul class="rooms">
      <% @another_entries.each do |e| %>
        <li>
          <%= link_to gravatar_for(e.user, size: 50), user_path(e.user) %>
          <span class="user">
          <%= link_to e.user.name, user_path(e.user) %>
          </span>
          <span class="message">
          <%= link_to room_path(e.room) do %>
            <% if Message.find_by(id: e.room.message_ids.last) %>
              <%= Message.find_by(id: e.room.message_ids.last).message.truncate(38, omission: "...") %>
            <% else %>
              トークを始めましょう！
            <% end %>
          <% end %>
          </span>
          <span class="timestamp">
            <% if Message.find_by(id: e.room.message_ids.last) %>
              <%= Message.find_by(id: e.room.message_ids.last).created_at.strftime("%Y-%m-%d %H:%M") %>
            <% else %>
              <%= e.created_at.strftime("%Y-%m-%d %H:%M") %>
            <% end %>
            <%= link_to "トークルームを削除", e.room, method: :delete,
                                       data: { confirm: "削除してもよろしいですか？" } %>
          </span>
        </li>
      <% end %>
    </ul>
  </div>
</div>
